(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2403],{60480:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return z}});var i,r=t(77837),s=t(82394),o=t(75582),l=t(38860),u=t.n(l),c=t(82684),a=t(12691),d=t.n(a),h=t(21764),p=t(69864),m=t(71180),y=t(90299),b=t(70652),f=t(50724),v=t(15338),j=t(1402),x=t(55485),Z=t(85854),_=t(48670),g=t(93808),w=t(44085),k=t(28274),O=t(38276);!function(e){e.SSH="ssh",e.HTTPS="https"}(i||(i={}));var P=[{autoComplete:"remote_repo_link",label:"Remote repo url",required:!0,uuid:"remote_repo_link"},{autoComplete:"repo_path",label:"Local directory path",labelDescription:"Defaults to Python's os.getcwd() if omitted. Mage will create this local directory if it doesn't already exist.",uuid:"repo_path"}],C=[{autoComplete:"username",label:"Username",uuid:"username"},{autoComplete:"email",label:"Email",uuid:"email"},{autoComplete:"ssh_public_key",label:"SSH public key in base64",type:"password",uuid:"ssh_public_key"},{autoComplete:"ssh_private_key",label:"SSH private key in base64",type:"password",uuid:"ssh_private_key"}],S=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",label:"Email",required:!0,uuid:"email"},{autoComplete:"access_token",label:"Access token",labelDescription:"Add your Git access token to authenticate with your provided username. The access token will be stored as a Mage secret.",required:!0,type:"password",uuid:"access_token"}],T=[{autoComplete:"branch",label:"Branch name",required:!0,uuid:"branch"}],M=t(30160),I=t(17488),q=t(35686),A=t(70515),E=t(24755),G=t(15610),N=t(72619),H=t(69419),D=t(28598);function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function B(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var W={label:function(){return"One-way Git Sync"},uuid:"git_sync"},F={label:function(){return"Git Actions"},uuid:"git_integration"},U=[W,F];function L(){var e=q.ZP.syncs.list().data,n=(0,c.useState)(null),t=n[0],r=n[1],l=(0,c.useState)(null),u=l[0],a=l[1],g=(0,c.useState)(null),R=g[0],L=g[1];(0,c.useEffect)((function(){if(e){var n,t=null===e||void 0===e||null===(n=e.syncs)||void 0===n?void 0:n[0];a(null===t||void 0===t?void 0:t.user_git_settings),r(t)}}),[e]);var z=(0,c.useMemo)((function(){if(e){var n,t=null===e||void 0===e||null===(n=e.syncs)||void 0===n?void 0:n[0];return!(null===t||void 0===t||!t.branch)}return!1}),[e]),X=q.ZP.git_branches.detail("test",{_format:"with_basic_details"},{revalidateOnFocus:!1}),V=X.data,Y=(X.mutate,(0,c.useMemo)((function(){return(null===V||void 0===V?void 0:V.git_branch)||{}}),[V]).is_git_integration_enabled),J=(0,p.Db)(q.ZP.syncs.useCreate(),{onSuccess:function(e){return(0,N.wD)(e,{callback:function(e){var n=e.sync;n&&(r(n),window.location.reload(),h.Am.success("Sync saved",{position:h.Am.POSITION.BOTTOM_RIGHT,toastId:"data_sync_success"}))},onErrorCallback:function(e,n){return L({errors:n,response:e})}})}}),K=(0,o.Z)(J,2),Q=K[0],$=K[1].isLoading,ee=(0,p.Db)(q.ZP.syncs.useUpdate("git"),{onSuccess:function(e){return(0,N.wD)(e,{callback:function(e){e.sync&&h.Am.success("Success!",{position:h.Am.POSITION.BOTTOM_RIGHT,toastId:"data_sync_success"})},onErrorCallback:function(e,n){return L({errors:n,response:e})}})}}),ne=(0,o.Z)(ee,2),te=ne[0],ie=ne[1].isLoading,re=(0,c.useMemo)((function(){return(null===t||void 0===t?void 0:t.auth_type)||i.SSH}),[null===t||void 0===t?void 0:t.auth_type]),se=(0,c.useMemo)((function(){return re===i.HTTPS?S:C}),[re]),oe=q.ZP.statuses.list().data,le=(0,c.useMemo)((function(){var e,n;return null===oe||void 0===oe||null===(e=oe.statuses)||void 0===e||null===(n=e[0])||void 0===n?void 0:n.require_user_authentication}),[oe]),ue=(0,c.useMemo)((function(){return U}),[]),ce=(0,c.useState)(),ae=ce[0],de=ce[1];(0,c.useEffect)((function(){ae||de(Y?F:W)}),[Y,ae]);var he=(0,c.useMemo)((function(){var e=r,n=t;return(null===ae||void 0===ae?void 0:ae.uuid)===F.uuid&&le&&(e=a,n=u),(0,D.jsx)("form",{children:se.map((function(t){var i,r,o=t.autoComplete,l=t.disabled,u=t.label,c=t.labelDescription,a=t.required,d=t.type,p=t.uuid;return r="ssh_public_key"===p?(0,D.jsx)(O.Z,{mb:1,children:(0,D.jsxs)(M.ZP,{small:!0,children:["Run ",(0,D.jsx)(_.Z,{onClick:function(){navigator.clipboard.writeText("cat ~/.ssh/id_ed25519.pub | base64 | tr -d \\\\n && echo"),h.Am.success("Successfully copied to clipboard.",{position:h.Am.POSITION.BOTTOM_RIGHT,toastId:p})},small:!0,children:"cat ~/.ssh/id_ed25519.pub | base64 | tr -d \\\\n && echo"})," in terminal to get base64 encoded public key and paste the result here. The key will be stored as a Mage secret."]})}):"ssh_private_key"===p?(0,D.jsx)(O.Z,{mb:1,children:(0,D.jsxs)(M.ZP,{small:!0,children:["Follow same steps as the public key, but run ",(0,D.jsx)(_.Z,{onClick:function(){navigator.clipboard.writeText("cat ~/.ssh/id_ed25519 | base64 | tr -d \\\\n && echo"),h.Am.success("Successfully copied to clipboard.",{position:h.Am.POSITION.BOTTOM_RIGHT,toastId:p})},small:!0,children:"cat ~/.ssh/id_ed25519 | base64 | tr -d \\\\n && echo"})," instead. The key will be stored as a Mage secret."]})}):c&&(0,D.jsx)(O.Z,{mb:1,children:(0,D.jsx)(M.ZP,{small:!0,children:c})}),(0,D.jsxs)(O.Z,{mt:2,children:[r,(0,D.jsx)(I.Z,{autoComplete:o,disabled:l,label:u,onChange:function(n){e((function(e){return B(B({},e),{},(0,s.Z)({},p,n.target.value))}))},primary:!0,required:a,setContentOnMount:!0,type:d,value:(null===(i=n)||void 0===i?void 0:i[p])||""})]},p)}))})}),[se,le,ae,a,r,t,u]),pe=(0,H.iV)();(0,c.useEffect)((function(){null!==pe&&void 0!==pe&&pe.tab&&de(ue.find((function(e){return e.uuid===(null===pe||void 0===pe?void 0:pe.tab)})))}),[pe,ue]);var me=(0,c.useMemo)((function(){return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(O.Z,{mt:A.Mq,children:[(0,D.jsxs)(M.ZP,{inline:!0,children:["To learn more about One-way git sync, click"," "]}),(0,D.jsx)(_.Z,{bold:!0,href:"https://docs.mage.ai/production/data-sync/git-sync",openNewWindow:!0,children:"here"})]}),(0,D.jsx)(O.Z,{mt:A.Mq,children:(0,D.jsx)(M.ZP,{bold:!0,children:"Sync with a specified branch. These settings will be saved at the project level."})}),(0,D.jsx)("form",{children:T.map((function(e){var n=e.autoComplete,i=e.disabled,o=e.label,l=e.required,u=e.type,c=e.uuid;return(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsx)(I.Z,{autoComplete:n,disabled:i,label:o,onChange:function(e){r((function(n){return B(B({},n),{},(0,s.Z)({},c,e.target.value))}))},primary:!0,required:l,setContentOnMount:!0,type:u,value:(null===t||void 0===t?void 0:t[c])||""})},c)}))}),(0,D.jsx)(x.ZP,{alignItems:"center",children:(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsx)(b.Z,{checked:null===t||void 0===t?void 0:t.sync_submodules,label:"Include submodules",onClick:function(){r((function(e){return B(B({},e),{},{sync_submodules:!(null!==t&&void 0!==t&&t.sync_submodules)})}))}})})}),(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsx)(Z.Z,{level:5,children:"Additional sync settings"})}),(0,D.jsx)(x.ZP,{alignItems:"center",children:(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsx)(b.Z,{checked:null===t||void 0===t?void 0:t.sync_on_pipeline_run,label:"Sync before each trigger run",onClick:function(){r((function(e){return B(B({},e),{},{sync_on_pipeline_run:!(null!==t&&void 0!==t&&t.sync_on_pipeline_run)})}))}})})}),(0,D.jsx)(x.ZP,{alignItems:"center",children:(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsx)(b.Z,{checked:null===t||void 0===t?void 0:t.sync_on_start,label:"Sync on server start up",onClick:function(){r((function(e){return B(B({},e),{},{sync_on_start:!(null!==t&&void 0!==t&&t.sync_on_start)})}))}})})}),(0,D.jsx)(O.Z,{mt:A.Mq,children:(0,D.jsx)(M.ZP,{bold:!0,children:"Configure the Git authentication credentials that will be used to sync with the specified Git repository."})}),he]})}),[t,he]),ye=(0,c.useMemo)((function(){return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(O.Z,{mt:A.Mq,children:[!Y&&(0,D.jsx)(O.Z,{mb:1,children:(0,D.jsx)(M.ZP,{bold:!0,warning:!0,children:"When One-way git sync is enabled, you will be unable to access the Git Actions modal. If you want to bypass this safeguard, set the GIT_ENABLE_GIT_INTEGRATION environment variable."})}),(0,D.jsxs)(M.ZP,{bold:!0,children:["We recommend using the ",(0,D.jsx)(d(),{as:"/version-control",href:"/version-control",children:(0,D.jsx)(_.Z,{bold:!0,inline:!0,children:"version control app"})})," unless you have a specific need to use the Git Actions modal."]})]}),(0,D.jsx)(O.Z,{mt:A.Mq,children:(0,D.jsx)(M.ZP,{children:"These fields are required to help Mage configure your Git settings. These settings will be specific to your user."})}),he]})}),[Y,he]);return(0,D.jsx)(k.Z,{uuidItemSelected:E.fF,uuidWorkspaceSelected:E.WH,children:(0,D.jsxs)(O.Z,{p:A.cd,style:{width:"600px"},children:[(0,D.jsx)(Z.Z,{children:"Git repository settings"}),(0,D.jsx)(O.Z,{mt:1,children:(0,D.jsx)(M.ZP,{bold:!0,children:"Authentication type"})}),(0,D.jsx)(O.Z,{mt:1,children:(0,D.jsx)(w.Z,{compact:!0,label:"Authentication type",onChange:function(e){var n=e.target.value;r((function(e){return B(B({},e),{},{auth_type:n})}))},value:re,children:Object.entries(i).map((function(e){var n=(0,o.Z)(e,2),t=n[0],i=n[1];return(0,D.jsx)("option",{value:i,children:t},i)}))})}),(0,D.jsx)(O.Z,{mt:A.Mq,children:re===i.SSH&&(0,D.jsxs)(M.ZP,{bold:!0,children:["You will need to ",(0,D.jsx)(_.Z,{href:"https://docs.mage.ai/development/git/configure#generate-ssh-token",openNewWindow:!0,children:"set up your SSH key"})," if you have not done so already."]})}),(0,D.jsx)("form",{children:P.map((function(e){var n=e.autoComplete,i=e.disabled,o=e.label,l=e.labelDescription,u=e.required,c=e.type,a=e.uuid;return(0,D.jsxs)(O.Z,{mt:2,children:[l&&(0,D.jsx)(O.Z,{mb:1,children:(0,D.jsx)(M.ZP,{small:!0,children:l})}),(0,D.jsx)(I.Z,{autoComplete:n,disabled:i,label:o,onChange:function(e){r((function(n){return B(B({},n),{},(0,s.Z)({},a,e.target.value))}))},primary:!0,required:u,setContentOnMount:!0,type:c,value:(null===t||void 0===t?void 0:t[a])||""})]},a)}))}),(0,D.jsx)(O.Z,{mt:A.Mq,children:(0,D.jsx)(v.Z,{light:!0})}),(0,D.jsx)(y.Z,{onClickTab:function(e){var n=e.uuid;(0,G.u)({tab:n})},selectedTabUUID:null===ae||void 0===ae?void 0:ae.uuid,tabs:ue,underlineStyle:!0}),(0,D.jsx)(v.Z,{light:!0}),(0,D.jsxs)(O.Z,{ml:2,children:[W.uuid===(null===ae||void 0===ae?void 0:ae.uuid)&&me,F.uuid===(null===ae||void 0===ae?void 0:ae.uuid)&&ye]}),(0,D.jsx)(O.Z,{mt:A.HN,children:(0,D.jsx)(m.ZP,{loading:$,onClick:function(){return Q({sync:B(B({},t),{},{user_git_settings:u})})},primary:!0,children:"Save repository settings"})}),R&&(0,D.jsx)(f.Z,{disableClickOutside:!0,isOpen:!0,onClickOutside:function(){return null===L||void 0===L?void 0:L(null)},children:(0,D.jsx)(j.Z,B(B({},R),{},{onClose:function(){return null===L||void 0===L?void 0:L(null)}}))}),z&&(0,D.jsxs)(O.Z,{mt:A.HN,children:[(0,D.jsx)(Z.Z,{children:"Synchronize code from remote repository"}),(0,D.jsxs)(O.Z,{mt:1,children:[(0,D.jsxs)(M.ZP,{children:["Running the sync from this page will run a one time sync with the remote repository.",(0,D.jsx)("br",{}),"This may ",(0,D.jsx)(M.ZP,{bold:!0,danger:!0,inline:!0,children:"overwrite"})," your existing data, so make sure you\u2019ve committed or backed up your current changes."]}),(0,D.jsx)(O.Z,{mt:2}),(0,D.jsxs)(M.ZP,{children:["Reset will tell Mage to try to clone your repository from remote. This will also ",(0,D.jsx)(M.ZP,{bold:!0,danger:!0,inline:!0,children:"overwrite"})," all your local changes and reset any settings you may have configured for your local Git repo. This may be helpful if you are having issues syncing your repository."]})]}),(0,D.jsx)(O.Z,{mt:2,children:(0,D.jsxs)(x.ZP,{children:[(0,D.jsx)(m.ZP,{loading:ie,onClick:function(){return te({sync:{action_type:"sync_data"}})},warning:!0,children:"Synchronize code"}),(0,D.jsx)(O.Z,{ml:2}),(0,D.jsx)(m.ZP,{danger:!0,loading:ie,onClick:function(){return te({sync:{action_type:"reset"}})},children:"Reset repository"})]})})]})]})})}L.getInitialProps=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));var z=(0,g.Z)(L)},37056:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/workspace/sync-data",function(){return t(60480)}])}},function(e){e.O(0,[1557,5699,9774,2888,179],(function(){return n=37056,e(e.s=n);var n}));var n=e.O();_N_E=n}]);