(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8450],{16488:function(e,n,t){"use strict";t.d(n,{IJ:function(){return b},M8:function(){return P},Uc:function(){return j},XM:function(){return E},_U:function(){return v},eI:function(){return k},gU:function(){return y},lO:function(){return T},ri:function(){return h},tL:function(){return _},vJ:function(){return g},xH:function(){return O}});var r,i=t(82394),u=t(92083),o=t.n(u),l=t(3917),c=t(4383),a=t(30229),s=t(42122),f=t(86735);function d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?d(Object(t),!0).forEach((function(n){(0,i.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var v=function(e){return!!e&&!Object.values(a.U5).includes(e)};function b(e){return null===e||void 0===e?void 0:e.reduce((function(e,n){var t=n.block_uuid,r=n.completed_at,u=n.started_at,l=n.status,c=null;u&&r&&(c=o()(r).valueOf()-o()(u).valueOf());return p(p({},e),{},(0,i.Z)({},t,{runtime:c,status:l}))}),{})}var m,h=function(e){var n=[{description:function(){return"This pipeline will run continuously on an interval or just once."},label:function(){return"Schedule"},uuid:a.Xm.TIME},{description:function(){return"This pipeline will run when a specific event occurs."},label:function(){return"Event"},uuid:a.Xm.EVENT},{description:function(){return"Run this pipeline when you make an API call."},label:function(){return"API"},uuid:a.Xm.API}];return e?n.slice(0,1):n};function O(e){var n=(0,s.gR)(e,[a.gm.INTERVAL,a.gm.TYPE]),t=e[a.gm.INTERVAL];t&&(n["schedule_interval[]"]=encodeURIComponent(t));var r=e[a.gm.TYPE];return r&&(n["schedule_type[]"]=r),n}function k(e){return e?new Date(o()(e).valueOf()):null}function j(e,n){return n?(0,l.XG)(e,n):function(e){if("string"!==typeof e)return e;var n=e.split("+")[0];return o()(k(n)).format(l.Nx)}(e)}!function(e){e.DAY="day",e.HOUR="hour",e.MINUTE="minute",e.SECOND="second"}(m||(m={}));var _=(r={},(0,i.Z)(r,m.DAY,86400),(0,i.Z)(r,m.HOUR,3600),(0,i.Z)(r,m.MINUTE,60),(0,i.Z)(r,m.SECOND,1),r);function y(e){var n=m.SECOND,t=e;return e%86400===0?(t/=86400,n=m.DAY):e%3600===0?(t/=3600,n=m.HOUR):e%60===0&&(t/=60,n=m.MINUTE),{time:t,unit:n}}function g(e,n){return e*_[n]}function E(e,n,t){var r,i=o()(e);return i.set("hour",+(null===n||void 0===n?void 0:n.hour)||0),i.set("minute",+(null===n||void 0===n?void 0:n.minute)||0),i.set("second",0),r=i.format(l.TD),null!==t&&void 0!==t&&t.includeSeconds&&(r=r.concat(":00")),null!==t&&void 0!==t&&t.localTimezone&&(r=i.format(l.lE),null!==t&&void 0!==t&&t.convertToUtc&&(r=(0,l.d$)(r,{includeSeconds:null===t||void 0===t?void 0:t.includeSeconds,utcFormat:!0}))),r}function P(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="",r=!0;if(r){var i=(0,c.XF)();n?t="".concat(i,"/api/pipeline_schedules/").concat(null===e||void 0===e?void 0:e.id,"/api_trigger"):(t="".concat(i,"/api/pipeline_schedules/").concat(null===e||void 0===e?void 0:e.id,"/pipeline_runs"),null!==e&&void 0!==e&&e.token&&(t="".concat(t,"/").concat(e.token)))}return t}function w(e,n,t){return e.match(/[*,-/]/)?{additionalOffset:0,cronValue:e}:function(e,n,t){var r=t.indexOf(e),i=0;if(n<0)for(var u=0;u>n;u--)0===r?(r=t.length-1,i-=1):r-=1;else if(n>0)for(var o=0;o<n;o++)r===t.length-1?(r=0,i+=1):r+=1;var l="number"===typeof t[r]?t[r]:e;return{additionalOffset:i,cronValue:String(l)}}(+e,n,t)}var Z=(0,f.m5)(60),x=(0,f.m5)(24),D=(0,l.Cs)();function T(e,n){if(!e)return e;var t=o()().local().format("Z"),r=t.split(":"),i="-"===t[0],u=3===r[0].length?Number(r[0].slice(1)):Number(r[0]),l=Number(r[1]);(i&&!n||!i&&n)&&(u=-u,l=-l);var c=e.split(" "),a=c[0],s=c[1],f=c[2],d=w(a,l,Z),p=w(s,u+d.additionalOffset,x);if(c[0]=d.cronValue,c[1]=p.cronValue,0!==(null===p||void 0===p?void 0:p.additionalOffset)){var v=w(f,p.additionalOffset,D);c[2]=v.cronValue}return c.join(" ")}},83641:function(e,n,t){"use strict";t.d(n,{I7:function(){return r},IB:function(){return c},VV:function(){return u},_7:function(){return o},rn:function(){return l}});var r,i=t(41143),u="datetime",o="code",l=i.V;!function(e){e.SECOND="second",e.MINUTE="minute",e.HOUR="hour",e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year",e.CUSTOM="custom"}(r||(r={}));var c=[r.MINUTE,r.HOUR,r.DAY,r.WEEK,r.MONTH,r.YEAR]},4303:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return z}});var r=t(77837),i=t(75582),u=t(38860),o=t.n(u),l=t(82684),c=t(69864),a=t(34376),s=t(82394),f=t(12691),d=t.n(f),p=t(83641),v=t(71180),b=t(55485),m=t(48670),h=t(75499),O=t(30160),k=t(35686),j=t(50724),_=t(89515),y=t(38276),g=t(81655),E=t(72191),P=t(72473),w=t(72619),Z=t(23780),x=t(28598);var D=function(e){var n=e.fetchItems,t=e.mutationFn,r=e.path,u=e.pipelineUUID,o=(0,a.useRouter)(),s=(0,l.useRef)({}),f=(0,l.useState)(null),d=f[0],p=f[1],b=(0,l.useState)(0),m=b[0],h=b[1],O=(0,l.useState)(0),k=O[0],D=O[1],T=(0,Z.VI)(null,{},[],{uuid:"".concat(r,"/").concat(u,"/delete/error")}),C=(0,i.Z)(T,1)[0],N=(0,c.Db)((function(e){return t(e)()}),{onSuccess:function(e){return(0,w.wD)(e,{callback:function(){null===n||void 0===n||n(),u&&o.push("/pipelines/[pipeline]/".concat(r),"/pipelines/".concat(u,"/").concat(r))},onErrorCallback:function(e,n){return C({errors:n,response:e})}})}}),I=(0,i.Z)(N,1)[0];return{deleteButton:function(e,n,t){return s.current[e]=(0,l.createRef)(),(0,x.jsxs)(y.Z,{mr:1,children:[(0,x.jsx)(v.ZP,{default:!0,iconOnly:!0,noBackground:!0,onClick:function(){var n,t,r,i;p(e),h((null===(n=s.current[e])||void 0===n||null===(t=n.current)||void 0===t?void 0:t.offsetTop)||0),D((null===(r=s.current[e])||void 0===r||null===(i=r.current)||void 0===i?void 0:i.offsetLeft)||0)},ref:s.current[e],title:"Delete",children:(0,x.jsx)(P.Trash,{default:!0,size:E.bL})}),(0,x.jsx)(j.Z,{onClickOutside:function(){return p(null)},open:d===e,children:(0,x.jsx)(_.Z,{danger:!0,left:(k||0)-g.nH,onCancel:function(){return p(null)},onClick:function(){p(null),I(e)},title:t,top:(m||0)-(n<=1?g.oz:g.OK),width:g.Xx})})]})}}},T=t(44265),C=t(70515),N=t(16488),I=t(50178),S=t(70320),U=t(3917);function R(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?R(Object(t),!0).forEach((function(n){(0,s.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var M=function(e){var n=e.fetchBackfills,t=e.models,r=e.onClickRow,i=e.pipeline,u=e.selectedRow,o=(0,I.Ct)(),c=(0,S.qB)(),a=null===i||void 0===i?void 0:i.uuid,s=c?g.O$:{},f=D({fetchItems:n,mutationFn:k.ZP.backfills.useDelete,path:"backfills",pipelineUUID:a}).deleteButton,j=[{uuid:"Status"},{uuid:"Name"},{uuid:"Type"},{uuid:"Runs"},A(A({},s),{},{uuid:"Backfill"}),A(A({},s),{},{uuid:"Started at"}),A(A({},s),{},{uuid:"Completed at"})];return o||j.push({label:function(){return""},uuid:"edit_delete_backfill"}),(0,x.jsx)(h.Z,{columnFlex:[null,1,null,null,null,1,1,null],columns:j,isSelectedRow:function(e){return t[e].id===(null===u||void 0===u?void 0:u.id)},onClickRow:function(e){return null===r||void 0===r?void 0:r(t[e])},rows:t.map((function(e,n){var t=e.block_uuid,r=e.completed_at,i=e.end_datetime,u=e.id,s=e.name,h=e.start_datetime,k=e.started_at,j=e.status,_=e.total_run_count,y=[(0,l.createElement)(O.ZP,A(A({},(0,g.NC)(j)),{},{key:"status"}),j||"inactive"),(0,x.jsx)(d(),{as:"/pipelines/".concat(a,"/backfills/").concat(u),href:"/pipelines/[pipeline]/backfills/[...slug]",passHref:!0,children:(0,x.jsx)(m.Z,{bold:!0,sameColorAsText:!0,children:s})},"name"),(0,x.jsx)(O.ZP,{default:!0,monospace:!0,children:t?p._7:p.VV},"type"),(0,x.jsx)(O.ZP,{default:!0,monospace:!0,children:_||0},"runs"),(0,x.jsxs)(O.ZP,{default:!0,monospace:!0,small:!0,children:[h&&i&&(0,x.jsxs)(x.Fragment,{children:[(0,N.Uc)(h,c),"\xa0-\xa0",(0,N.Uc)(i,c)]}),!(h&&i)&&(0,x.jsx)(x.Fragment,{children:"\u2014"})]},"backfill"),(0,x.jsx)(O.ZP,{default:!0,monospace:!0,small:!0,title:k?(0,U._6)(k):null,children:k?(0,N.Uc)(k,c):(0,x.jsx)(x.Fragment,{children:"\u2014"})},"started_at"),(0,x.jsx)(O.ZP,{default:!0,monospace:!0,small:!0,title:r?(0,U._6)(r):null,children:r?(0,N.Uc)(r,c):(0,x.jsx)(x.Fragment,{children:"\u2014"})},"completed_at")];return o||y.push((0,x.jsxs)(b.ZP,{children:[(0,x.jsx)(v.ZP,{default:!0,disabled:j===T.VO.COMPLETED,iconOnly:!0,linkProps:{as:"/pipelines/".concat(a,"/backfills/").concat(u,"/edit"),href:"/pipelines/[pipeline]/backfills/[...slug]"},noBackground:!0,title:"Edit",children:(0,x.jsx)(P.Edit,{default:!0,size:2*C.iI})},"".concat(n,"_edit_button")),f(u,n,'Are you sure you want to delete the backfill "'.concat(s,'?"'))]},"edit_delete_backfill_".concat(n))),y})),uuid:"pipeline-runs"})},V=t(68562),B=t(75457),F=t(93808),H=t(28795),L=t(69419),Y=t(81728);function X(e){var n=e.pipeline,t=(0,a.useRouter)(),r=n.uuid,u=k.ZP.backfills.list({_limit:20,_offset:0,include_run_count:!0,pipeline_uuid:r},{refreshInterval:6e4}),o=u.data,s=u.mutate,f=(0,l.useMemo)((function(){return(null===o||void 0===o?void 0:o.backfills)||[]}),[o]),d=(0,L.iV)(),p=(0,l.useState)(null),v=p[0],b=p[1],m=(0,l.useState)(null),h=m[0],j=m[1];(0,l.useEffect)((function(){null!==d&&void 0!==d&&d.backfill_id?b(null===f||void 0===f?void 0:f.find((function(e){return e.id===Number(d.backfill_id)}))):v&&b(null)}),[f,d,v]);var _=(0,l.useMemo)((function(){var e="/pipelines/".concat(r,"/backfills"),n=[{label:function(){return"Backfills"},linkProps:v?{as:e,href:"/pipelines/[pipeline]/backfills"}:null}];return v&&n.push({label:function(){return v.name}}),n}),[r,v]),g=(0,c.Db)(k.ZP.backfills.pipelines.useCreate(r),{onSuccess:function(e){return(0,w.wD)(e,{callback:function(e){var n=e.backfill.id;t.push("/pipelines/[pipeline]/backfills/[...slug]","/pipelines/".concat(r,"/backfills/").concat(n,"/edit"))},onErrorCallback:function(e,n){return j({errors:n,response:e})}})}}),E=(0,i.Z)(g,2),Z=E[0],D=E[1].isLoading;return(0,x.jsxs)(B.Z,{breadcrumbs:_,errors:h,pageName:H.M.BACKFILLS,pipeline:n,setErrors:j,title:function(e){var n=e.name;return"".concat(n," backfills")},uuid:"".concat(H.M.BACKFILLS,"_").concat(r),children:[(0,x.jsx)(y.Z,{p:C.cd,children:(0,x.jsx)(V.ZP,{beforeElement:(0,x.jsx)(P.Add,{size:2.5*C.iI}),blackBorder:!0,inline:!0,loading:D,noHoverUnderline:!0,onClick:function(){return Z({backfill:{name:(0,Y.Y6)()}})},sameColorAsText:!0,uuid:"PipelineDetailPage/Backfills/add_new_backfill",children:"Create new backfill"})}),f&&0===f.length&&(0,x.jsx)(y.Z,{p:C.cd,children:(0,x.jsx)(O.ZP,{bold:!0,default:!0,monospace:!0,muted:!0,children:"No backfills available"})}),(null===f||void 0===f?void 0:f.length)>=1&&(0,x.jsx)(M,{fetchBackfills:s,models:f,pipeline:n,selectedRow:v})]})}X.getInitialProps=function(){var e=(0,r.Z)(o().mark((function e(n){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.query.pipeline,e.abrupt("return",{pipeline:{uuid:t}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();var z=(0,F.Z)(X)},37459:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pipelines/[pipeline]/backfills",function(){return t(4303)}])},80022:function(e,n,t){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}t.d(n,{Z:function(){return r}})},15544:function(e,n,t){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.d(n,{Z:function(){return r}})},13692:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(61049);function i(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&(0,r.Z)(e,n)}},93189:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var r=t(12539),i=t(80022);function u(e,n){if(n&&("object"===r(n)||"function"===typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(e)}}},function(e){e.O(0,[1557,3782,9774,2888,179],(function(){return n=37459,e(e.s=n);var n}));var n=e.O();_N_E=n}]);